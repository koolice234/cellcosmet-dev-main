(()=>{var t={382:(t,e,r)=>{r.p=window.ORW.appUrl.replace(/assets\/$/,"")}},e={};function r(a){var i=e[a];if(void 0!==i)return i.exports;var s=e[a]={exports:{}};return t[a](s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var a=e.getElementsByTagName("script");a.length&&(t=a[a.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t+"../"})(),(()=>{"use strict";r(382);const t=jQuery;var e=r.n(t);let a={};ORW.enableGTM&&(ORW.marketing=ORW.marketing||new class{constructor(){this.settings=ORW.marketingSettings||"",console.log("init marketing"),this.trackPromosViaDataLayer=!1,this.customSearchEvent=!1,this.dataAttributeItem="[data-ga-item-json]",this.productPageSelector=".product-core",this.cartPageSelector=".cart-item",this.signUpFormID="create_customer",this.promoParentClass=this.settings.promoParentClass||"ga-promo-element",this.dataAttributePromo=this.settings.dataAttributePromo||"[data-ga-promo-json]",this.cartCurrency=this.settings.cartCurrency||""}get gaEvents(){return{add_to_cart:"dl_add_to_cart",remove_from_cart:"dl_remove_from_cart",view_cart:"dl_view_cart",begin_checkout:"dl_begin_checkout",add_shipping_info:"dl_add_shipping_info",add_payment_info:"dl_add_payment_info",view_item_list:"dl_view_item_list",view_item:"dl_view_item",view_promotion:"dl_view_promotion",select_promotion:"dl_select_promotion",add_to_wishlist:"dl_add_to_wishlist",search:"dl_search",sign_up:"dl_sign_up"}}dataLayerPush(t,e){window.dataLayer=window.dataLayer||[],window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:t,ecommerce:e})}initCartWatchers(){let t;e()(".cart-items").on("click",".item-remove",(t=>{this.removeFromCart(t.currentTarget)})),e()(".cart-items").on("change","[data-cart-quantity]",(e=>{clearTimeout(t),t=setTimeout((()=>{this.checkItemQtyChangeCart(e)}),500)}))}initVariantWatcher(t){var r,i;i=r=>{let a=r.id;e()(t).find(this.dataAttributeItem).data("ga-variant-id",a)},void 0===a[r="variant-change"]&&(a[r]=[]),a[r]=[...a[r],i]}initWishlistWatcher(){e()(document.body).on("click",".add-to-wishlist",(t=>{this.addToWishlist(t.target)}))}initPromoWatchers(){e()(this.dataAttributePromo).each(((t,r)=>{const a=this.__parseItemJSON(r);if(a){const t=e()(r).parent(),i=e()(r).data("ga-promo-click");if(this.trackPromosViaDataLayer?this.viewPromo(a):t.addClass(this.promoParentClass),i){let e=t;!0!==i&&(e=t.find(i)),this.selectPromo(e,a)}}}))}viewPromo(t){const e=this.gaEvents.view_promotion;this.dataLayerPush(e,t)}selectPromo(t,r){const a=this.gaEvents.select_promotion;e()(t).one("click",(t=>{t.preventDefault(),this.dataLayerPush(a,r),this.__triggerButtonOrLink(t.target)}))}viewItem(t){const e=this.gaEvents.view_item,r=this.__getItemDataFromJSON(t);if(r){const t=this.__createEcommerceObjectFromItem(r);this.dataLayerPush(e,t)}}addToWishlist(t){const r=this.gaEvents.add_to_wishlist,a=e()(t).parents(this.productPageSelector),i=this.__getItemDataFromJSON(a);if(i){const t=this.__createEcommerceObjectFromItem(i);this.dataLayerPush(r,t)}}viewItemList(t,e){const r=this.gaEvents.view_item_list,a=t.data("ga-id"),i=t.data("ga-name");let s=this.__createListItemsArray(e);const o=ORW.utilities.getUrlParam(window.location.href,"q");if(o&&this.customSearchEvent&&this.search(o),s.length>0){const t={item_list_id:a,item_list_name:i,items:s};this.dataLayerPush(r,t)}}search(t){const e=this.gaEvents.search,r={search_term:t.replace("+"," ")};this.dataLayerPush(e,r)}signUp(){const t=this.gaEvents.sign_up;this.dataLayerPush(t,{method:"Shopify"})}accountForm(t){e()(t).attr("id")===this.signUpFormID&&this.signUp()}removeFromCart(t){const r=this.gaEvents.remove_from_cart,a=e()(t).parents(this.cartPageSelector),i=this.__getItemDataFromJSON(a);if(i){const t=this.__createEcommerceObjectFromItem(i);t.value=-1*t.value,this.dataLayerPush(r,t)}}async viewCart(){const t=this.gaEvents.view_cart,e=await this.__getCart();if(e){const r=this.__createEcommerceObjectFromCart(e);this.dataLayerPush(t,r)}}checkItemQtyChangeCart(t){let r=t.currentTarget,a=this.__preferNumber(r.value)-this.__preferNumber(r.defaultValue),i=e()(r).parents(this.cartPageSelector),s=this.__getItemDataFromJSON(i);if(s){s.quantity=Math.abs(a);const t=this.__createEcommerceObjectFromItem(s);let e;a>0?e=this.gaEvents.add_to_cart:a<0&&(e=this.gaEvents.remove_from_cart,t.value=-1*t.value),e&&this.dataLayerPush(e,t)}}checkItemQtyManualChangeCartPage(){const t=e()("input.js-qty__num");let r=[],a=[],i=0,s=0;for(let o of t){const t=e()(o).parents(this.cartPageSelector),n=this.__getItemDataFromJSON(t),c=this.__preferNumber(e()(o).val());if(n&&n.quantity!==c){const t=c-n.quantity;n.quantity=Math.abs(t);const e=n.price*n.quantity;t>0?(i+=e,r.push(n)):(s-=e,a.push(n))}}if(r.length>0){const t=this.gaEvents.add_to_cart,e={currency:this.cartCurrency,value:i,items:r};this.dataLayerPush(t,e)}if(a.length>0){const t=this.gaEvents.remove_from_cart,e={currency:this.cartCurrency,value:s,items:a};this.dataLayerPush(t,e)}}addToCart(t){const r=this.gaEvents.add_to_cart;let a=1,i=e()(t).find("input.qty-input");i.length>0&&(a=i.val());let s=e()(t).parents(this.productPageSelector),o=this.__getItemDataFromJSON(s);if(o){o.quantity=this.__preferNumber(a);const t=this.__createEcommerceObjectFromItem(o);this.dataLayerPush(r,t)}}async checkoutEvents(){const t={contact_information:this.gaEvents.begin_checkout,shipping_method:this.gaEvents.add_shipping_info,payment_method:this.gaEvents.add_payment_info};if(window.Shopify&&window.Shopify.Checkout){const r=window.Shopify.Checkout.step;if(r){const a=t[r];if(a){const t=await this.__getCart();if(t){const r=this.__createEcommerceObjectFromCart(t);r.coupon=e()("[data-ga-checkout-coupons]").html()||"",this.dataLayerPush(a,r)}}}}}async __getCart(){let t,e;try{t=await fetch("/cart.js")}catch(t){console.error(t)}return t?.ok&&(e=await t.json()),e}__getItemDataFromJSON(t){const e=this.__getItemJSON(t),r=this.__parseItemJSON(e);let a;if(r){const t=e.data("ga-variant-id");a=t?this.__getProductInfo(r,this.__preferNumber(t)):this.__getItemInfo(r)}return a}__parseItemJSON(t){const r=e()(t).html();let a;try{a=JSON.parse(r)}catch(t){return!1}return a}__getItemJSON(t){const r=e()(t).find(this.dataAttributeItem);return r.length>0?r:t}__createEcommerceObjectFromItem(t){const e=t.price*t.quantity,r={currency:this.cartCurrency,value:this.__preferNumber(e)};return r.items=[t],r}__createEcommerceObjectFromCart(t){const e=this.__formatPrice(t.total_price),r={currency:t.currency||this.cartCurrency,value:this.__preferNumber(e)};return r.items=this.__createCartItemsArray(t),r}__getItemInfo(t){const e=this.__formatPrice(t.final_price),r=this.__formatPrice(t.line_level_total_discount),a=this.__getItemCoupons(t);return{item_id:t.sku,item_name:t.product_title,item_brand:t.vendor,item_category:t.product_type,item_variant:t.variant_title,price:this.__preferNumber(e),quantity:this.__preferNumber(t.quantity),affiliation:t.selling_plan_allocation_selling_plan_name||"",coupon:a,discount:this.__preferNumber(r)}}__getProductInfo(t,e){let r=t;for(const a of t.variants)if(a.id===e){r=a;break}const a=this.__formatPrice(r.price);return{item_id:r.sku,item_name:t.title,item_brand:t.vendor,item_category:t.type,item_variant:r.title,price:this.__preferNumber(a),quantity:1,affiliation:"",coupon:"",discount:0}}__createCartItemsArray(t){let e=[];for(let r of t.items){const t=this.__getItemInfo(r);e.push(t)}return e}__createListItemsArray(t){let r=[];for(let a of t){if(a.classList.contains("promo"))continue;const t=this.__getItemDataFromJSON(a);if(t){const i=e()(a).data("product-index");t.index=this.__zeroBasedIndex(i),r.push(t)}}return r}__getItemCoupons(t){let e=[];const r=t.line_level_discount_allocations;if(r)for(let t of r){const r=t.discount_application.title.trim();e.push(r)}return e.join(", ")}__triggerButtonOrLink(t){const r=e()(t).children().attr("href");r?location.href=r:t.click()}__zeroBasedIndex(t){return this.__preferNumber(t)-1}__preferNumber(t){return Number(t)||t}__formatPrice(t){let e=t?t/100:"";return""===e&&(e=0),e}},ORW.marketing.checkoutEvents())})()})();
//# sourceMappingURL=checkout.js.map